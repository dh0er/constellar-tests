name: Run All Tests

on:
    workflow_dispatch:
        inputs:
            ref:
                description: "Branch or tag to run on (default: current ref)"
                required: false
                default: ""

permissions:
    contents: read
    actions: write

jobs:
    dispatch:
        name: Dispatch all test workflows
        runs-on: ubuntu-slim
        strategy:
            fail-fast: false
            matrix:
                workflow_file:
                    - tests-ios.yml
                    - tests-android.yml
                    - tests-web.yml
                    - tests-macos.yml
                    - tests-windows.yml
                    - tests-linux.yml
        steps:
            - name: Trigger ${{ matrix.workflow_file }}
              uses: actions/github-script@v7
              with:
                  github-token: ${{ secrets.GITHUB_TOKEN }}
                  script: |
                      const workflow_id = "${{ matrix.workflow_file }}";
                      const refInput = "${{ inputs.ref }}".trim();
                      const ref = refInput || context.ref.replace(/^refs\/(heads|tags)\//, "");

                      core.info(`Dispatching ${workflow_id} on ref=${ref}`);

                      await github.rest.actions.createWorkflowDispatch({
                        owner: context.repo.owner,
                        repo: context.repo.repo,
                        workflow_id,
                        ref,
                      });
